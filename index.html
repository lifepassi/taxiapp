<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>íƒì‹œ ê¸°ì‚¬ ìˆ˜ìµ ì•±</title>

<style>
* { box-sizing: border-box; font-family: system-ui, sans-serif; }
body {
  margin: 0;
  background: #f4f6f8;
}
.container {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}
h1 {
  text-align: center;
  margin-bottom: 12px;
}
.card {
  background: #fff;
  border-radius: 14px;
  padding: 14px;
  margin-bottom: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}
input, button, select {
  width: 100%;
  padding: 12px;
  font-size: 18px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin-top: 8px;
}
button {
  background: #2563eb;
  color: white;
  font-weight: bold;
  border: none;
}
.sum {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  margin-top: 6px;
}
.muted {
  color: #777;
  font-size: 14px;
}
.hidden { display: none; }
</style>
</head>

<body>
<div class="container">
  <h1>ğŸš• ê¸°ì‚¬ ìˆ˜ìµ ê¸°ë¡</h1>

  <div class="card">
    <input id="empId" type="number" placeholder="ì‚¬ë²ˆ ì…ë ¥" oninput="loadData()" />
  </div>

  <div class="card">
    <label>ğŸ“… ë‚ ì§œ</label>
    <input id="date" type="date" />
    <label>ğŸ’° ìˆ˜ìµ</label>
    <input id="income" type="number" />
    <label>ğŸ“ ê±°ë¦¬ (km)</label>
    <input id="distance" type="number" />
    <label>â›½ LPG</label>
    <input id="lpg" type="number" />
    <button onclick="submitData()">ì €ì¥</button>
  </div>

  <div class="card" id="summary">
    <h3>ğŸ“Š ëˆ„ì  í•©ê³„</h3>
    <div class="sum"><span>ìˆ˜ìµ</span><span id="sumIncome">0</span></div>
    <div class="sum"><span>ê±°ë¦¬</span><span id="sumDistance">0</span></div>
    <div class="sum"><span>LPG</span><span id="sumLpg">0</span></div>
  </div>

  <div class="card">
    <label>ğŸ“† ë‚ ì§œë³„ ë³´ê¸°</label>
    <input type="date" id="filterDate" onchange="filterByDate()" />
    <div id="dateResult" class="muted"></div>
  </div>

  <div class="card">
    <label>ğŸ—“ ì›”ë³„ í•©ê³„</label>
    <input type="month" id="filterMonth" onchange="filterByMonth()" />
    <div id="monthResult" class="muted"></div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxQcpmH4yZAT9Z_n9va5zCEidMgV1PbxsRwNuDsgM5Nx3VBmgUoitwCqxYAvubEUkUZ/exec";

let cachedData = [];

document.getElementById("date").valueAsDate = new Date();

function submitData() {
  const data = {
    empId: empId.value,
    date: date.value,
    income: income.value,
    distance: distance.value,
    lpg: lpg.value
  };

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(data)
  }).then(() => {
    income.value = distance.value = lpg.value = "";
    loadData();
  });
}

function loadData() {
  const id = empId.value;
  if (!id) return;

  fetch(API_URL + "?empId=" + id)
    .then(res => res.json())
    .then(data => {
      cachedData = data;
      updateSummary(data);
    });
}

function updateSummary(data) {
  let i=0,d=0,l=0;
  data.forEach(r=>{
    i+=r.income;
    d+=r.distance;
    l+=r.lpg;
  });
  sumIncome.innerText = i.toLocaleString();
  sumDistance.innerText = d.toLocaleString();
  sumLpg.innerText = l.toLocaleString();
}

function filterByDate() {
  const f = filterDate.value;
  const rows = cachedData.filter(r => r.date === f);
  if (!rows.length) {
    dateResult.innerText = "ê¸°ë¡ ì—†ìŒ";
    return;
  }
  let i=0,d=0,l=0;
  rows.forEach(r=>{
    i+=r.income; d+=r.distance; l+=r.lpg;
  });
  dateResult.innerText =
    `ìˆ˜ìµ ${i.toLocaleString()} / ê±°ë¦¬ ${d}km / LPG ${l}`;
}

function filterByMonth() {
  const m = filterMonth.value;
  const rows = cachedData.filter(r => r.date.startsWith(m));
  if (!rows.length) {
    monthResult.innerText = "ê¸°ë¡ ì—†ìŒ";
    return;
  }
  let i=0,d=0,l=0;
  rows.forEach(r=>{
    i+=r.income; d+=r.distance; l+=r.lpg;
  });
  monthResult.innerText =
    `ìˆ˜ìµ ${i.toLocaleString()} / ê±°ë¦¬ ${d}km / LPG ${l}`;
}
</script>
</body>
</html>

